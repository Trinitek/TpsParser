using NUnit.Framework;

namespace TpsParser.Tests;

internal sealed class TestMemoRecordPayload
{
    [Test]
    public void ShouldParse_With256MemoText()
    {
        byte[] data = [
            0x00, 0x02, 0xa3, 0xf8, /* TableNumber */
            0xfc,                   /* PayloadType */
            0x00, 0x02, 0xa4, 0x6e, /* RecordNumber */
            0x00,                   /* MemoIndex */
            0x00, 0x01,             /* SequenceNumber */
            0x4e, 0x6f, 0x73, 0x74, 0x72, 0x75, 0x64, 0x20, 0x69, 0x70, 0x73, 0x75, 0x6d, 0x20, 0x61, 0x6c,
            0x69, 0x71, 0x75, 0x61, 0x20, 0x65, 0x69, 0x75, 0x73, 0x6d, 0x6f, 0x64, 0x20, 0x63, 0x6f, 0x6e,
            0x73, 0x65, 0x63, 0x74, 0x65, 0x74, 0x75, 0x72, 0x20, 0x6e, 0x6f, 0x73, 0x74, 0x72, 0x75, 0x64,
            0x20, 0x61, 0x6c, 0x69, 0x71, 0x75, 0x69, 0x70, 0x20, 0x6e, 0x69, 0x73, 0x69, 0x20, 0x65, 0x6e,
            0x69, 0x6d, 0x20, 0x63, 0x6f, 0x6d, 0x6d, 0x6f, 0x64, 0x6f, 0x20, 0x6d, 0x69, 0x6e, 0x69, 0x6d,
            0x20, 0x75, 0x74, 0x2e, 0x20, 0x45, 0x78, 0x20, 0x63, 0x6f, 0x6d, 0x6d, 0x6f, 0x64, 0x6f, 0x20,
            0x61, 0x6c, 0x69, 0x71, 0x75, 0x69, 0x70, 0x20, 0x6c, 0x61, 0x62, 0x6f, 0x72, 0x69, 0x73, 0x20,
            0x65, 0x6c, 0x69, 0x74, 0x20, 0x69, 0x70, 0x73, 0x75, 0x6d, 0x20, 0x65, 0x61, 0x20, 0x64, 0x6f,
            0x6c, 0x6f, 0x72, 0x2e, 0x20, 0x41, 0x6c, 0x69, 0x71, 0x75, 0x61, 0x20, 0x65, 0x78, 0x65, 0x72,
            0x63, 0x69, 0x74, 0x61, 0x74, 0x69, 0x6f, 0x6e, 0x20, 0x6e, 0x6f, 0x73, 0x74, 0x72, 0x75, 0x64,
            0x20, 0x64, 0x6f, 0x6c, 0x6f, 0x72, 0x20, 0x76, 0x65, 0x6e, 0x69, 0x61, 0x6d, 0x20, 0x61, 0x64,
            0x69, 0x70, 0x69, 0x73, 0x63, 0x69, 0x6e, 0x67, 0x20, 0x76, 0x65, 0x6e, 0x69, 0x61, 0x6d, 0x20,
            0x61, 0x64, 0x2e, 0x20, 0x43, 0x6f, 0x6d, 0x6d, 0x6f, 0x64, 0x6f, 0x20, 0x76, 0x65, 0x6e, 0x69,
            0x61, 0x6d, 0x20, 0x61, 0x6c, 0x69, 0x71, 0x75, 0x61, 0x20, 0x6d, 0x69, 0x6e, 0x69, 0x6d, 0x20,
            0x75, 0x74, 0x20, 0x76, 0x65, 0x6e, 0x69, 0x61, 0x6d, 0x20, 0x65, 0x74, 0x20, 0x69, 0x70, 0x73,
            0x75, 0x6d, 0x20, 0x61, 0x6c, 0x69, 0x71, 0x75, 0x61, 0x20, 0x75, 0x74, 0x20, 0x73, 0x69, 0x74,
            ];

        var result = new MemoRecordPayload { PayloadData = data };

        using (Assert.EnterMultipleScope())
        {
            Assert.That(result.TableNumber, Is.EqualTo(0x0002a3f8));
            Assert.That(result.RecordNumber, Is.EqualTo(0x0002a46e));
            Assert.That(result.DefinitionIndex, Is.Zero);
            Assert.That(result.SequenceNumber, Is.EqualTo(1));

            byte[] expectedLoremIpsum = [
                0x4e, 0x6f, 0x73, 0x74, 0x72, 0x75, 0x64, 0x20, 0x69, 0x70, 0x73, 0x75, 0x6d, 0x20, 0x61, 0x6c,
                0x69, 0x71, 0x75, 0x61, 0x20, 0x65, 0x69, 0x75, 0x73, 0x6d, 0x6f, 0x64, 0x20, 0x63, 0x6f, 0x6e,
                0x73, 0x65, 0x63, 0x74, 0x65, 0x74, 0x75, 0x72, 0x20, 0x6e, 0x6f, 0x73, 0x74, 0x72, 0x75, 0x64,
                0x20, 0x61, 0x6c, 0x69, 0x71, 0x75, 0x69, 0x70, 0x20, 0x6e, 0x69, 0x73, 0x69, 0x20, 0x65, 0x6e,
                0x69, 0x6d, 0x20, 0x63, 0x6f, 0x6d, 0x6d, 0x6f, 0x64, 0x6f, 0x20, 0x6d, 0x69, 0x6e, 0x69, 0x6d,
                0x20, 0x75, 0x74, 0x2e, 0x20, 0x45, 0x78, 0x20, 0x63, 0x6f, 0x6d, 0x6d, 0x6f, 0x64, 0x6f, 0x20,
                0x61, 0x6c, 0x69, 0x71, 0x75, 0x69, 0x70, 0x20, 0x6c, 0x61, 0x62, 0x6f, 0x72, 0x69, 0x73, 0x20,
                0x65, 0x6c, 0x69, 0x74, 0x20, 0x69, 0x70, 0x73, 0x75, 0x6d, 0x20, 0x65, 0x61, 0x20, 0x64, 0x6f,
                0x6c, 0x6f, 0x72, 0x2e, 0x20, 0x41, 0x6c, 0x69, 0x71, 0x75, 0x61, 0x20, 0x65, 0x78, 0x65, 0x72,
                0x63, 0x69, 0x74, 0x61, 0x74, 0x69, 0x6f, 0x6e, 0x20, 0x6e, 0x6f, 0x73, 0x74, 0x72, 0x75, 0x64,
                0x20, 0x64, 0x6f, 0x6c, 0x6f, 0x72, 0x20, 0x76, 0x65, 0x6e, 0x69, 0x61, 0x6d, 0x20, 0x61, 0x64,
                0x69, 0x70, 0x69, 0x73, 0x63, 0x69, 0x6e, 0x67, 0x20, 0x76, 0x65, 0x6e, 0x69, 0x61, 0x6d, 0x20,
                0x61, 0x64, 0x2e, 0x20, 0x43, 0x6f, 0x6d, 0x6d, 0x6f, 0x64, 0x6f, 0x20, 0x76, 0x65, 0x6e, 0x69,
                0x61, 0x6d, 0x20, 0x61, 0x6c, 0x69, 0x71, 0x75, 0x61, 0x20, 0x6d, 0x69, 0x6e, 0x69, 0x6d, 0x20,
                0x75, 0x74, 0x20, 0x76, 0x65, 0x6e, 0x69, 0x61, 0x6d, 0x20, 0x65, 0x74, 0x20, 0x69, 0x70, 0x73,
                0x75, 0x6d, 0x20, 0x61, 0x6c, 0x69, 0x71, 0x75, 0x61, 0x20, 0x75, 0x74, 0x20, 0x73, 0x69, 0x74,
            ];

            Assert.That(result.Content.ToArray(), Is.EqualTo(expectedLoremIpsum));
        }
    }
}
